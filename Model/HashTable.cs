namespace Encryption;

public class HashTable {

    private static readonly Dictionary<string, List<string>> hashTable = new() {
        {"A",  ["2C00", "2800", "3500", "0D00", "2000", "2D00", "0B00", "2E00", "3200", "2900", "2800", "0000"]},
        {"B",  ["2F00", "2B00", "3600", "0E00", "2300", "2E00", "0800", "2D00", "3100", "2A00", "2B00", "0300"]},
        {"C",  ["2E00", "2A00", "3700", "0F00", "2200", "2F00", "0900", "2C00", "3000", "2B00", "2A00", "0200"]},
        {"D",  ["2900", "2D00", "3000", "0800", "2500", "2800", "0E00", "2B00", "3700", "2C00", "2D00", "0500"]},
        {"E",  ["2800", "2C00", "3100", "0900", "2400", "2900", "0F00", "2A00", "3600", "2D00", "2C00", "0400"]},
        {"F",  ["2B00", "2F00", "3200", "0A00", "2700", "2A00", "0C00", "2900", "3500", "2E00", "2F00", "0700"]},
        {"G",  ["2A00", "2E00", "3300", "0B00", "2600", "2B00", "0D00", "2800", "3400", "2F00", "2E00", "0600"]},
        {"H",  ["2500", "2100", "3C00", "0400", "2900", "2400", "0200", "2700", "3B00", "2000", "2100", "0900"]},
        {"I",  ["2400", "2000", "3D00", "0500", "2800", "2500", "0300", "2600", "3A00", "2100", "2000", "0800"]},
        {"J",  ["2700", "2300", "3E00", "0600", "2B00", "2600", "0000", "2500", "3900", "2200", "2300", "0B00"]},
        {"K",  ["2600", "2200", "3F00", "0700", "2A00", "2700", "0100", "2400", "3800", "2300", "2200", "0A00"]},
        {"L",  ["2100", "2500", "3800", "0000", "2D00", "2000", "0600", "2300", "3F00", "2400", "2500", "0D00"]},
        {"M",  ["2000", "2400", "3900", "0100", "2C00", "2100", "0700", "2200", "3E00", "2500", "2400", "0C00"]},
        {"N",  ["2300", "2700", "3A00", "0200", "2F00", "2200", "0400", "2100", "3D00", "2600", "2700", "0F00"]},
        {"O",  ["2200", "2600", "3B00", "0300", "2E00", "2300", "0500", "2000", "3C00", "2700", "2600", "0E00"]},
        {"P",  ["3D00", "3900", "2400", "1C00", "3100", "3C00", "1A00", "3F00", "2300", "3800", "3900", "1100"]},
        {"Q",  ["3C00", "3800", "2500", "1D00", "3000", "3D00", "1B00", "3E00", "2200", "3900", "3800", "1000"]},
        {"R",  ["3F00", "3B00", "2600", "1E00", "3300", "3E00", "1800", "3D00", "2100", "3A00", "3B00", "1300"]},
        {"S",  ["3E00", "3A00", "2700", "1F00", "3200", "3F00", "1900", "3C00", "2000", "3B00", "3A00", "1200"]},
        {"T",  ["3900", "3D00", "2000", "1800", "3500", "3800", "1E00", "3B00", "2700", "3C00", "3D00", "1500"]},
        {"U",  ["3800", "3C00", "2100", "1900", "3400", "3900", "1F00", "3A00", "2600", "3D00", "3C00", "1400"]},
        {"V",  ["3B00", "3F00", "2200", "1A00", "3700", "3A00", "1C00", "3900", "2500", "3E00", "3F00", "1700"]},
        {"W",  ["3A00", "3E00", "2300", "1B00", "3600", "3B00", "1D00", "3800", "2400", "3F00", "3E00", "1600"]},
        {"X",  ["3500", "3100", "2C00", "1400", "3900", "3400", "1200", "3700", "2B00", "3000", "3100", "1900"]},
        {"Y",  ["3400", "3000", "2D00", "1500", "3800", "3500", "1300", "3600", "2A00", "3100", "3000", "1800"]},
        {"Z",  ["3700", "3300", "2E00", "1600", "3B00", "3600", "1000", "3500", "2900", "3200", "3300", "1B00"]},
        {"a",  ["0C00", "0800", "1500", "2D00", "0000", "0D00", "2B00", "0E00", "1200", "0900", "0800", "2000"]},
        {"b",  ["0F00", "0B00", "1600", "2E00", "0300", "0E00", "2800", "0D00", "1100", "0A00", "0B00", "2300"]},
        {"c",  ["0E00", "0A00", "1700", "2F00", "0200", "0F00", "2900", "0C00", "1000", "0B00", "0A00", "2200"]},
        {"d",  ["0900", "0D00", "1000", "2800", "0500", "0800", "2E00", "0B00", "1700", "0C00", "0D00", "2500"]},
        {"e",  ["0800", "0C00", "1100", "2900", "0400", "0900", "2F00", "0A00", "1600", "0D00", "0C00", "2400"]},
        {"f",  ["0B00", "0F00", "1200", "2A00", "0700", "0A00", "2C00", "0900", "1500", "0E00", "0F00", "2700"]},
        {"g",  ["0A00", "0E00", "1300", "2B00", "0600", "0B00", "2D00", "0800", "1400", "0F00", "0E00", "2600"]},
        {"h",  ["0500", "0100", "1C00", "2400", "0900", "0400", "2200", "0700", "1B00", "0000", "0100", "2900"]},
        {"i",  ["0400", "0000", "1D00", "2500", "0800", "0500", "2300", "0600", "1A00", "0100", "0000", "2800"]},
        {"j",  ["0700", "0300", "1E00", "2600", "0B00", "0600", "2000", "0500", "1900", "0200", "0300", "2B00"]},
        {"k",  ["0600", "0200", "1F00", "2700", "0A00", "0700", "2100", "0400", "1800", "0300", "0200", "2A00"]},
        {"l",  ["0100", "0500", "1800", "2000", "0D00", "0000", "2600", "0300", "1F00", "0400", "0500", "2D00"]},
        {"m",  ["0000", "0400", "1900", "2100", "0C00", "0100", "2700", "0200", "1E00", "0500", "0400", "2C00"]},
        {"n",  ["0300", "0700", "1A00", "2200", "0F00", "0200", "2400", "0100", "1D00", "0600", "0700", "2F00"]},
        {"o",  ["0200", "0600", "1B00", "2300", "0E00", "0300", "2500", "0000", "1C00", "0700", "0600", "2E00"]},
        {"p",  ["1D00", "1900", "0400", "3C00", "1100", "1C00", "3A00", "1F00", "0300", "1800", "1900", "3100"]},
        {"q",  ["1C00", "1800", "0500", "3D00", "1000", "1D00", "3B00", "1E00", "0200", "1900", "1800", "3000"]},
        {"r",  ["1F00", "1B00", "0600", "3E00", "1300", "1E00", "3800", "1D00", "0100", "1A00", "1B00", "3300"]},
        {"s",  ["1E00", "1A00", "0700", "3F00", "1200", "1F00", "3900", "1C00", "0000", "1B00", "1A00", "3200"]},
        {"t",  ["1900", "1D00", "0000", "3800", "1500", "1800", "3E00", "1B00", "0700", "1C00", "1D00", "3500"]},
        {"u",  ["1800", "1C00", "0100", "3900", "1400", "1900", "3F00", "1A00", "0600", "1D00", "1C00", "3400"]},
        {"v",  ["1B00", "1F00", "0200", "3A00", "1700", "1A00", "3C00", "1900", "0500", "1E00", "1F00", "3700"]},
        {"w",  ["1A00", "1E00", "0300", "3B00", "1600", "1B00", "3D00", "1800", "0400", "1F00", "1E00", "3600"]},
        {"x",  ["1500", "1100", "0C00", "3400", "1900", "1400", "3200", "1700", "0B00", "1000", "1100", "3900"]},
        {"y",  ["1400", "1000", "0D00", "3500", "1800", "1500", "3300", "1600", "0A00", "1100", "1000", "3800"]},
        {"z",  ["1700", "1300", "0E00", "3600", "1B00", "1600", "3000", "1500", "0900", "1200", "1300", "3B00"]},
        {"+",  ["4600", "4200", "5F00", "6700", "4A00", "4700", "6100", "4400", "5800", "4300", "4200", "6A00"]},
        {"-",  ["4000", "4400", "5900", "6100", "4C00", "4100", "6700", "4200", "5E00", "4500", "4400", "6C00"]},
        {"_",  ["3200", "3600", "2B00", "1300", "3E00", "3300", "1500", "3000", "2C00", "3700", "3600", "1E00"]},
        {"=",  ["5000", "5400", "4900", "7100", "5C00", "5100", "7700", "5200", "4E00", "5500", "5400", "7C00"]},
        {"*",  ["4700", "4300", "5E00", "6600", "4B00", "4600", "6000", "4500", "5900", "4200", "4300", "6B00"]},
        {"(",  ["4500", "4100", "5C00", "6400", "4900", "4400", "6200", "4700", "5B00", "4000", "4100", "6900"]},
        {")",  ["4400", "4000", "5D00", "6500", "4800", "4500", "6300", "4600", "5A00", "4100", "4000", "6800"]},
        {"{",  ["1600", "1200", "0F00", "3700", "1A00", "1700", "3100", "1400", "0800", "1300", "1200", "3A00"]},
        {"}",  ["1000", "1400", "0900", "3100", "1C00", "1100", "3700", "1200", "0E00", "1500", "1400", "3C00"]},
        {"[",  ["3600", "3200", "2F00", "1700", "3A00", "3700", "1100", "3400", "2800", "3300", "3200", "1A00"]},
        {"]",  ["3000", "3400", "2900", "1100", "3C00", "3100", "1700", "3200", "2E00", "3500", "3400", "1C00"]},
        {":",  ["5700", "5300", "4E00", "7600", "5B00", "5600", "7000", "5500", "4900", "5200", "5300", "7B00"]},
        {";",  ["5600", "5200", "4F00", "7700", "5A00", "5700", "7100", "5400", "4800", "5300", "5200", "7A00"]},
        {"'",  ["4A00", "4E00", "5300", "6B00", "4600", "4B00", "6D00", "4800", "5400", "4F00", "4E00", "6600"]},
        {"\"", ["4F00", "4B00", "5600", "6E00", "4300", "4E00", "6800", "4D00", "5100", "4A00", "4B00", "6300"]},
        {"<",  ["5100", "5500", "4800", "7000", "5D00", "5000", "7600", "5300", "4F00", "5400", "5500", "7D00"]},
        {",",  ["4100", "4500", "5800", "6000", "4D00", "4000", "6600", "4300", "5F00", "4400", "4500", "6D00"]},
        {">",  ["5300", "5700", "4A00", "7200", "5F00", "5200", "7400", "5100", "4D00", "5600", "5700", "7F00"]},
        {".",  ["4300", "4700", "5A00", "6200", "4F00", "4200", "6400", "4100", "5D00", "4600", "4700", "6F00"]},
        {"\\", ["3100", "3500", "2800", "1000", "3D00", "3000", "1600", "3300", "2F00", "3400", "3500", "1D00"]},
        {"|",  ["1100", "1500", "0800", "3000", "1D00", "1000", "3600", "1300", "0F00", "1400", "1500", "3D00"]},
        {"!",  ["4C00", "4800", "5500", "6D00", "4000", "4D00", "6B00", "4E00", "5200", "4900", "4800", "6000"]},
        {"@",  ["2D00", "2900", "3400", "0C00", "2100", "2C00", "0A00", "2F00", "3300", "2800", "2900", "0100"]},
        {"$",  ["4900", "4D00", "5000", "6800", "4500", "4800", "6E00", "4B00", "5700", "4C00", "4D00", "6500"]},
        {"%",  ["4800", "4C00", "5100", "6900", "4400", "4900", "6F00", "4A00", "5600", "4D00", "4C00", "6400"]},
        {"^",  ["3300", "3700", "2A00", "1200", "3F00", "3200", "1400", "3100", "2D00", "3600", "3700", "1F00"]},
        {"&",  ["4B00", "4F00", "5200", "6A00", "4700", "4A00", "6C00", "4900", "5500", "4E00", "4F00", "6700"]},
        {"`",  ["0D00", "0900", "1400", "2C00", "0100", "0C00", "2A00", "0F00", "1300", "0800", "0900", "2100"]},
        {"~",  ["1300", "1700", "0A00", "3200", "1F00", "1200", "3400", "1100", "0D00", "1600", "1700", "3F00"]},
        {"0",  ["5D00", "5900", "4400", "7C00", "5100", "5C00", "7A00", "5F00", "4300", "5800", "5900", "7100"]},
        {"1",  ["5C00", "5800", "4500", "7D00", "5000", "5D00", "7B00", "5E00", "4200", "5900", "5800", "7000"]},
        {"2",  ["5F00", "5B00", "4600", "7E00", "5300", "5E00", "7800", "5D00", "4100", "5A00", "5B00", "7300"]},
        {"3",  ["5E00", "5A00", "4700", "7F00", "5200", "5F00", "7900", "5C00", "4000", "5B00", "5A00", "7200"]},
        {"4",  ["5900", "5D00", "4000", "7800", "5500", "5800", "7E00", "5B00", "4700", "5C00", "5D00", "7500"]},
        {"5",  ["5800", "5C00", "4100", "7900", "5400", "5900", "7F00", "5A00", "4600", "5D00", "5C00", "7400"]},
        {"6",  ["5B00", "5F00", "4200", "7A00", "5700", "5A00", "7C00", "5900", "4500", "5E00", "5F00", "7700"]},
        {"7",  ["5A00", "5E00", "4300", "7B00", "5600", "5B00", "7D00", "5800", "4400", "5F00", "5E00", "7600"]},
        {"8",  ["5500", "5100", "4C00", "7400", "5900", "5400", "7200", "5700", "4B00", "5000", "5100", "7900"]},
        {"9",  ["5400", "5000", "4D00", "7500", "5800", "5500", "7300", "5600", "4A00", "5100", "5000", "7800"]}
    };

    public static String GetEncryptedText(string text, bool isAscci = false) {
        int cycleIndex = 0;
        int cycleCount = 12;

        String encryptedText = "";
        for (int i = 0; i < text.Length; i++) {
            if (!hashTable.ContainsKey(text[i].ToString())) { throw new Exception("Invalid character"); }

            string hashedCharacter = hashTable[text[i].ToString()][cycleIndex];
            if (isAscci) { hashedCharacter = hashedCharacter[..2];} // "2C00" -> "2C"

            encryptedText += hashedCharacter;
            cycleIndex = (cycleIndex + 1) % cycleCount;
        }

        return encryptedText;
    }

    public static String GetDecryptedText(string encryptedText, bool isAscci = false) {
        int cycleIndex = 0;
        int cycleCount = 12;

        String decryptedText = "";

        for (int i = 0; i <= encryptedText.Length - (isAscci ? 2 : 4); i += isAscci ? 2 : 4) {
            decryptedText += Find(string.Concat(encryptedText.AsSpan(i, isAscci ? 2 : 4), isAscci ? "00" : ""), cycleIndex);

            cycleIndex = (cycleIndex + 1) % cycleCount;
        }

        return decryptedText;
    }

    private static String Find(String text, int index) {
        foreach (String key in hashTable.Keys) {
            if (hashTable[key][index] == text) {
                return key;
            }
        }
        throw new Exception("Cannot Decrypt the text");

    }

}